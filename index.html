<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SGDTI - Sistema de Gerenciamento do Departamento de TI</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        // Verificar autentica√ß√£o via localStorage
        (function() {
            var userData = localStorage.getItem('sgdti_user');
            
            if (!userData) {
                window.location.href = 'login.html';
                return;
            }
            
            try {
                var user = JSON.parse(userData);
                window.currentUser = user;
                window.isAdmin = user.perfil === 'admin';
                
                document.addEventListener('DOMContentLoaded', function() {
                    var userInfo = document.getElementById('user-info');
                    if (userInfo) {
                        userInfo.textContent = user.nome;
                    }
                    
                    // Mostrar/ocultar elementos baseado no perfil
                    if (window.isAdmin) {
                        // Mostrar bot√£o de gerenciamento de usu√°rios
                        var manageBtn = document.getElementById('manage-users-btn');
                        if (manageBtn) manageBtn.style.display = 'inline-flex';
                    } else {
                        // Ocultar todos os bot√µes de CRUD para usu√°rios n√£o-admin
                        var style = document.createElement('style');
                        style.textContent = '.crud-toolbar, .crud-btn, .crud-actions, .btn-action.btn-edit, .btn-action.btn-delete { display: none !important; }';
                        document.head.appendChild(style);
                    }
                });
            } catch (e) {
                localStorage.removeItem('sgdti_user');
                window.location.href = 'login.html';
            }
        })();
    </script>
</head>
<body>
    <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Abrir menu">
        <span>‚ò∞</span>
    </button>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">

            <div class="logo-section">
                <div class="logo">
                    <div class="logo-icon-wrapper">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="logo-svg">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                            <line x1="8" y1="21" x2="16" y2="21"/>
                            <line x1="12" y1="17" x2="12" y2="21"/>
                        </svg>
                    </div>
                    <div class="logo-text">
                        <h1>SGDTI</h1>
                        <span>Sistema de Gerenciamento</span>
                    </div>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Expandir/Recolher menu" tabindex="0" style="margin-left:auto; background:transparent; border:none; font-size:1.5em; cursor:pointer; display:none;">
                    <span class="nav-icon">‚ò∞</span>
                </button>
            </div>

            <nav class="nav-menu">
                <button class="nav-item active" data-tab="dashboard" tabindex="0">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-label">Dashboard</span>
                </button>
                <button class="nav-item" data-tab="ti" tabindex="0">
                    <span class="nav-icon">üíª</span>
                    <span class="nav-label">Equipe TI</span>
                    <span class="nav-badge" id="nav-badge-ti">0</span>
                </button>
                <button class="nav-item" data-tab="impressoras" tabindex="0">
                    <span class="nav-icon">üñ®Ô∏è</span>
                    <span class="nav-label">Impressoras</span>
                    <span class="nav-badge" id="nav-badge-impressoras">0</span>
                </button>
                <button class="nav-item" data-tab="internet" tabindex="0">
                    <span class="nav-icon">üåê</span>
                    <span class="nav-label">Internet</span>
                    <span class="nav-badge" id="nav-badge-internet">0</span>
                </button>
                <button class="nav-item" data-tab="equipamentos" tabindex="0">
                    <span class="nav-icon">üîß</span>
                    <span class="nav-label">Equipamentos</span>
                    <span class="nav-badge" id="nav-badge-equipamentos">0</span>
                </button>
                <button class="nav-item" data-tab="emails" tabindex="0">
                    <span class="nav-icon">üìß</span>
                    <span class="nav-label">Emails Corporativos</span>
                    <span class="nav-badge" id="nav-badge-emails">0</span>
                </button>
                <button class="nav-item" data-tab="vigencias" tabindex="0">
                    <span class="nav-icon">üìã</span>
                    <span class="nav-label">Vig√™ncias Internets</span>
                    <span class="nav-badge" id="nav-badge-vigencias">0</span>
                </button>
                <button class="nav-item" data-tab="viagens" tabindex="0">
                    <span class="nav-icon">‚úàÔ∏è</span>
                    <span class="nav-label">Escala de Viagens</span>
                    <span class="nav-badge" id="nav-badge-viagens">0</span>
                </button>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <div class="header-actions">
                    <div class="view-mode-toggle">
                        <button class="view-btn active" data-view="cards" title="Visualiza√ß√£o em Cards">
                            <span>üì±</span>
                        </button>
                        <button class="view-btn" data-view="table" title="Visualiza√ß√£o em Tabela">
                            <span>üìã</span>
                        </button>
                    </div>
                    <div class="user-actions">
                        <a id="manage-users-btn" class="btn-header" title="Gerenciar Usu√°rios" style="display:none;" href="usuarios.html">
                            <span>üë•</span> Usu√°rios
                        </a>
                        <span id="user-info" class="user-name">Carregando...</span>
                        <button id="logout-btn" class="btn-header btn-logout" title="Sair" onclick="logout()">
                            <span>üö™</span> Sair
                        </button>
                    </div>
                </div>
            </header>

            <div class="content-area">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content active">
                    <div class="page-header">
                        <h2>üìä Dashboard Geral</h2>
                        <p>Vis√£o geral do Departamento de TI</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card gradient-5" id="card-equipamentos" style="cursor:pointer;">
                            <div class="stat-icon">üîß</div>
                            <div class="stat-info">
                                <h3>0</h3>
                                <p>Equipamentos</p>
                            </div>
                        </div>
                        <div class="stat-card gradient-1" id="card-ti" style="cursor:pointer;">
                            <div class="stat-icon">üíª</div>
                            <div class="stat-info">
                                <h3>0</h3>
                                <p>Profissionais TI</p>
                            </div>
                        </div>
                        <div class="stat-card gradient-3" id="card-impressoras" style="cursor:pointer;">
                            <div class="stat-icon">üñ®Ô∏è</div>
                            <div class="stat-info">
                                <h3>0</h3>
                                <p>Impressoras</p>
                            </div>
                        </div>
                        <div class="stat-card gradient-4" id="card-internet" style="cursor:pointer;">
                            <div class="stat-icon">üåê</div>
                            <div class="stat-info">
                                <h3>0</h3>
                                <p>Links de Internet</p>
                            </div>
                        </div>
                        <div class="stat-card gradient-6" id="card-emails" style="cursor:pointer;">
                            <div class="stat-icon">üìß</div>
                            <div class="stat-info">
                                <h3>0</h3>
                                <p>Emails Corporativos</p>
                            </div>
                        </div>
                        <div class="stat-card gradient-2" id="card-vigencias" style="cursor:pointer;">
                            <div class="stat-icon">üìã</div>
                            <div class="stat-info">
                                <h3>0</h3>
                                <p>Vig√™ncias Internets</p>
                            </div>
                        </div>
                        <div class="stat-card gradient-7" id="card-viagens" style="cursor:pointer;">
                            <div class="stat-icon">‚úàÔ∏è</div>
                            <div class="stat-info">
                                <h3>0</h3>
                                <p>Viagens Agendadas</p>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h3>üó∫Ô∏è Distribui√ß√£o por Cidade</h3>
                            <div class="city-tabs">
                                <button class="city-tab active" data-source="ti">üíª Equipe TI</button>
                                <button class="city-tab" data-source="impressoras">üñ®Ô∏è Impressoras</button>
                                <button class="city-tab" data-source="internet">üåê Internet</button>
                                <button class="city-tab" data-source="equipamentos">üîß Equipamentos</button>
                            </div>
                            <div class="city-list" id="cityList"></div>
                            <p class="city-hint">üëÜ Clique em uma cidade para ver os detalhes</p>
                        </div>
                        <div class="dashboard-card">
                            <h3>üìà Status Geral</h3>
                            <div class="status-overview">
                                <div class="status-item">
                                    <span class="status-dot success"></span>
                                    <span>Impressoras Funcionando</span>
                                    <strong id="impressorasFuncionando">0</strong>
                                </div>
                                <div class="status-item">
                                    <span class="status-dot success"></span>
                                    <span>Links de Internet</span>
                                    <strong id="linksAtivos">0</strong>
                                </div>
                                <div class="status-item">
                                    <span class="status-dot info"></span>
                                    <span>Equipamentos Cadastrados</span>
                                    <strong id="equipamentosCadastrados">0</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TI Tab -->
                <div id="ti" class="tab-content">
                    <div class="page-header">
                        <h2>üíª Equipe de TI</h2>
                        <p>Profissionais de TI do Departamento</p>
                    </div>
                    <div class="filters">
                        <select class="filter-select" id="tiCityFilter">
                            <option value="">Todas as Cidades</option>
                        </select>
                    </div>
                    <div id="tiContent" class="data-container"></div>
                </div>

                <!-- Impressoras Tab -->
                <div id="impressoras" class="tab-content">
                    <div class="page-header">
                        <h2>üñ®Ô∏è Impressoras</h2>
                        <p>Controle de impressoras do Departamento</p>
                    </div>
                    <div class="filters">
                        <select class="filter-select" id="impressoraCityFilter">
                            <option value="">Todas as Cidades</option>
                        </select>
                        <select class="filter-select" id="impressoraStatusFilter">
                            <option value="">Todos os Status</option>
                            <option value="SIM">Funcionando</option>
                            <option value="N√ÉO">Com Problema</option>
                            <option value="LOCADAS">Locadas</option>
                            <option value="PATRIMONIAIS">Patrimoniais</option>
                        </select>
                    </div>
                    <div id="impressorasContent" class="data-container"></div>
                </div>

                <!-- Internet Tab -->
                <div id="internet" class="tab-content">
                    <div class="page-header">
                        <h2>üåê Links de Internet</h2>
                        <p>Velocidades e operadoras</p>
                    </div>
                    <div class="filters">
                        <select class="filter-select" id="internetCityFilter">
                            <option value="">Todas as Cidades</option>
                        </select>
                        <select class="filter-select" id="internetOperadoraFilter">
                            <option value="">Todas as Operadoras</option>
                        </select>
                        <button class="btn-export-excel" id="btnExportInternet" onclick="exportInternetToExcel()" title="Exportar para Excel">
                            <span>üìä</span> Exportar Excel
                        </button>
                    </div>
                    <div id="internetContent" class="data-container"></div>
                </div>

                <!-- Equipamentos Tab -->
                <div id="equipamentos" class="tab-content">
                    <div class="page-header">
                        <h2>üîß Equipamentos de TI</h2>
                        <p>Ferramentas e equipamentos dispon√≠veis</p>
                    </div>
                    <div class="filters">
                        <select class="filter-select" id="equipamentoCityFilter">
                            <option value="">Todas as Cidades</option>
                        </select>
                    </div>
                    <div id="equipamentosContent" class="data-container"></div>
                </div>

                <!-- Emails Corporativos Tab -->
                <div id="emails" class="tab-content">
                    <div class="page-header">
                        <h2>üìß Emails Corporativos</h2>
                        <p>Lista de usu√°rios e emails corporativos</p>
                    </div>
                    <div class="filters">
                        <input type="text" class="filter-select" id="emailSearchFilter" placeholder="Buscar por nome, CPF ou email..." style="width: 300px;">
                        <select class="filter-select" id="emailStatusFilter">
                            <option value="">Todos os Status</option>
                            <option value="criado">Criado</option>
                            <option value="Solicitado">Solicitado</option>
                        </select>
                        <button class="btn-export-excel" id="btnExportEmails" onclick="exportEmailsToExcel()" title="Exportar para Excel">
                            <span>üì•</span> Exportar Excel
                        </button>
                    </div>
                    <div id="emailsContent" class="data-container"></div>
                </div>

                <!-- Vig√™ncias Internets Tab -->
                <div id="vigencias" class="tab-content">
                    <div class="page-header">
                        <h2>üìã Vig√™ncias Internets</h2>
                        <p>Controle de contratos e vig√™ncias de internet</p>
                    </div>
                    <div class="filters">
                        <input type="text" class="filter-select" id="vigenciasSearchFilter" placeholder="Buscar por fornecedor, cidade, setor..." style="width: 300px;">
                        <select class="filter-select" id="vigenciasCityFilter">
                            <option value="">Todas as Cidades</option>
                        </select>
                        <select class="filter-select" id="vigenciasStatusFilter">
                            <option value="">Todos os Status</option>
                            <option value="SIM">Contrato OK</option>
                            <option value="N√ÉO">Contrato com Problema</option>
                            <option value="PENDENTE">Pendente</option>
                        </select>
                        <button class="btn-export-excel" id="btnExportVigencias" onclick="exportVigenciasToExcel()" title="Exportar para Excel">
                            <span>üì•</span> Exportar Excel
                        </button>
                    </div>
                    <div class="vigencias-summary" id="vigenciasSummary"></div>
                    <div id="vigenciasContent" class="data-container"></div>
                </div>

                <!-- Viagens Tab -->
                <div id="viagens" class="tab-content">
                    <div class="page-header">
                        <h2>‚úàÔ∏è Escala de Viagens</h2>
                        <p>Controle manual de viagens e deslocamentos da equipe</p>
                    </div>
                    <div class="filters">
                        <input type="text" class="filter-select" id="viagensSearchFilter" placeholder="Buscar por respons√°vel, destino, motivo..." style="width: 300px;">
                        <select class="filter-select" id="viagensStatusFilter">
                            <option value="">Todos os Status</option>
                            <option value="AGENDADA">Agendada</option>
                            <option value="EM_ANDAMENTO">Em Andamento</option>
                            <option value="CONCLUIDA">Conclu√≠da</option>
                            <option value="CANCELADA">Cancelada</option>
                        </select>
                        <select class="filter-select" id="viagensDestinoFilter">
                            <option value="">Todos os Destinos</option>
                        </select>
                        <button class="btn-export-excel" id="btnExportViagens" onclick="exportViagensToExcel()" title="Exportar para Excel">
                            <span>üì•</span> Exportar Excel
                        </button>
                    </div>
                    <div class="viagens-summary" id="viagensSummary"></div>
                    <div id="viagensContent" class="data-container"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de Detalhes -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- N√ÉO MAIS NECESS√ÅRIO: data.js foi substitu√≠do por APIs PHP -->
    <!-- <script src="data.js"></script> -->
    <script src="admin.js"></script>
    <script src="admin-integration.js"></script>
    <script src="script.js"></script>
    <script>
    // ========== FUN√á√ÉO DE LOGOUT ==========
    
    function logout() {
        localStorage.removeItem('sgdti_user');
        window.location.href = 'login.html';
    }

    // Redirecionamento dos cart√µes do dashboard para as abas
    document.addEventListener('DOMContentLoaded', function() {
        var cardTi = document.getElementById('card-ti');
        var cardCotecs = document.getElementById('card-cotecs');
        var cardImpressoras = document.getElementById('card-impressoras');
        var cardInternet = document.getElementById('card-internet');
        var cardEquipamentos = document.getElementById('card-equipamentos');
        if(cardTi) cardTi.addEventListener('click', function() { window.switchTab ? switchTab('ti') : document.querySelector('[data-tab="ti"]').click(); });
        if(cardCotecs) cardCotecs.addEventListener('click', function() { window.switchTab ? switchTab('dashboard') : document.querySelector('[data-tab="dashboard"]').click(); });
        if(cardImpressoras) cardImpressoras.addEventListener('click', function() { window.switchTab ? switchTab('impressoras') : document.querySelector('[data-tab="impressoras"]').click(); });
        if(cardInternet) cardInternet.addEventListener('click', function() { window.switchTab ? switchTab('internet') : document.querySelector('[data-tab="internet"]').click(); });
        if(cardEquipamentos) cardEquipamentos.addEventListener('click', function() { window.switchTab ? switchTab('equipamentos') : document.querySelector('[data-tab="equipamentos"]').click(); });
        var cardEmails = document.getElementById('card-emails');
        if(cardEmails) cardEmails.addEventListener('click', function() { window.switchTab ? switchTab('emails') : document.querySelector('[data-tab="emails"]').click(); });
        var cardVigencias = document.getElementById('card-vigencias');
        if(cardVigencias) cardVigencias.addEventListener('click', function() { window.switchTab ? switchTab('vigencias') : document.querySelector('[data-tab="vigencias"]').click(); });
        var cardViagens = document.getElementById('card-viagens');
        if(cardViagens) cardViagens.addEventListener('click', function() { window.switchTab ? switchTab('viagens') : document.querySelector('[data-tab="viagens"]').click(); });
    });
    </script>
</body>
</html>
